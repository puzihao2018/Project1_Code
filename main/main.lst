                  2   $LIST
0000              4   
0000              5   org 0x0000 ; Reset vector
0000 0204F1       6       ljmp MainProgram
0003              7   
0003              8   org 0x0003 ; External interrupt 0 vector (not used in this code)
0003 32           9            reti
0004             10   
000B             11   org 0x000B ; Timer/Counter 0 overflow interrupt vector (not used in this code)
000B 32          12            reti
000C             13   
0013             14   org 0x0013 ; External interrupt 1 vector (not used in this code)
0013 32          15            reti
0014             16   
001B             17   org 0x001B ; Timer/Counter 1 overflow interrupt vector (not used in this code
001B 32          18            reti
001C             19   
0023             20   org 0x0023 ; Serial port receive/transmit interrupt vector (not used in this code)
0023 32          21            reti
0024             22   
005B             23   org 0x005b ; CCU interrupt vector.  Used in this code to replay the wave file.
005B 32          24            reti
005C             25   
005C             26   
005C             27   ;-------------------;
005C             28   ;    Const Define   ;
005C             29   ;-------------------; 
005C             30   CCU_RELOAD equ #2000
005C             31   
005C             32   
005C             33   ;-------------------;
005C             34   ;    Ports Define   ;
005C             35   ;-------------------; 
005C             36   FLASH_CE equ P2.4
005C             37   BUTTON equ P3.0
005C             38   ;-----------------------;
005C             39   ;    Variables Define   ;
005C             40   ;-----------------------; 
005C             41   ;Variable_name: ds n
0030             42   dseg at 0x30
0030             43   
0030             44   state: ds 1
0031             45   
0031             46   ;-------------------;
0031             47   ;    Flags Define   ;
0031             48   ;-------------------; 
0031             49   ;Flag_name: dbit 1
0000             50   bseg
0000             51   
0000             52   
005C             53   cseg
                616   $LIST
                 60   $LIST
04F1             62   
                 63   BUTTON_PUSHED mac
                 64       jb BUTTON, NOTPUSHED%M
                 65       Wait_Milli_Seconds(75)
                 66       jb BUTTON, NOTPUSHED%M
                 67       jnb BUTTON, $
                 68       inc state
                 69   NOTPUSHED%M
                 70   endmac
04F1             71   
04F1             72   MainProgram:
04F1 1204D8      73       lcall Ports_Init
04F4 1201EE      74            lcall LCD_4BIT
04F7 753000      75       mov state, #0
04FA             76   
04FA             77   ;start fsm
04FA             78   MainLoop:
04FA E530        79       mov a, state
04FC             80       FSM1_STATE0:
04FC B4004F      81           cjne a, #0, FSM1_STATE1
04FF C0E0        82            push acc
0501 7401        82            mov a, #1
0503 14          82            dec a
0504 120230      82            lcall ?Set_Cursor_1 ; Select column and row
0507 D0E0        82            pop acc
0509 C083        82            push dph
050B C082        82            push dpl
050D C0E0        82            push acc
050F 900068      82            mov dptr, #WELCOME1
0512 120223      82            lcall ?Send_Constant_String
0515 D0E0        82            pop acc
0517 D082        82            pop dpl
0519 D083        82            pop dph
051B C0E0        82            push acc
051D 7401        82            mov a, #1
051F 14          82            dec a
0520 12022E      82            lcall ?Set_Cursor_2 ; Select column and row
0523 D0E0        82            pop acc
0525 C083        82            push dph
0527 C082        82            push dpl
0529 C0E0        82            push acc
052B 900079      82            mov dptr, #WELCOME2
052E 120223      82            lcall ?Send_Constant_String
0531 D0E0        82            pop acc
0533 D082        82            pop dpl
0535 D083        82            pop dph
0537 20B011      83           jb BUTTON, FSM1_STATE0_DONE
053A C002        84            push AR2
053C 7A4B        84            mov R2, #75
053E 12019F      84            lcall ?Wait_Milli_Seconds
0541 D002        84            pop AR2
0543 20B005      85           jb BUTTON, FSM1_STATE0_DONE
0546 30B0FD      86           jnb BUTTON, $
0549 0530        87           inc state
054B             88       FSM1_STATE0_DONE:
054B 0204FA      89           ljmp MainLoop
054E             90       FSM1_STATE1:
054E B4014D      91           cjne a, #1, FSM1_STATE1_DONE
0551 C0E0        92            push acc
0553 7401        92            mov a, #1
0555 14          92            dec a
0556 120230      92            lcall ?Set_Cursor_1 ; Select column and row
0559 D0E0        92            pop acc
055B C083        92            push dph
055D C082        92            push dpl
055F C0E0        92            push acc
0561 90008A      92            mov dptr, #SETTING1
0564 120223      92            lcall ?Send_Constant_String
0567 D0E0        92            pop acc
0569 D082        92            pop dpl
056B D083        92            pop dph
056D C0E0        92            push acc
056F 7401        92            mov a, #1
0571 14          92            dec a
0572 12022E      92            lcall ?Set_Cursor_2 ; Select column and row
0575 D0E0        92            pop acc
0577 C083        92            push dph
0579 C082        92            push dpl
057B C0E0        92            push acc
057D 90009B      92            mov dptr, #SETTING2
0580 120223      92            lcall ?Send_Constant_String
0583 D0E0        92            pop acc
0585 D082        92            pop dpl
0587 D083        92            pop dph
0589 20B012      93           jb BUTTON, FSM1_STATE1_DONE
058C C002        94            push AR2
058E 7A4B        94            mov R2, #75
0590 12019F      94            lcall ?Wait_Milli_Seconds
0593 D002        94            pop AR2
0595 20B006      95           jb BUTTON, FSM1_STATE1_DONE
0598 30B0FD      96           jnb BUTTON, $
059B 753000      97           mov state, #0
059E             98       FSM1_STATE1_DONE:
059E 0204FA      99           ljmp MainLoop
05A1            100           
05A1            101   
05A1            102   END
